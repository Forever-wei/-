<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>éšæœºé€‰æ‹©ç¨‹åº</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.15);
            text-align: center;
            width: 800px;
            max-width: 90%;
            animation: fadeIn 0.5s ease-out;
        }
        h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        textarea {
            width: calc(100% - 34px); /* å‡å»paddingå’Œborderçš„å®½åº¦ */
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ccc;
            border-radius: 6px;
            min-height: 100px;
            font-size: 1.2rem;
            line-height: 1.6;
            box-sizing: border-box; /* ç¡®ä¿å®½åº¦è®¡ç®—åŒ…å«paddingå’Œborder */
            resize: vertical; /* åªå…è®¸å‚ç›´è°ƒæ•´å¤§å° */
            max-width: 100%; /* é˜²æ­¢è¶…å‡ºçˆ¶å®¹å™¨ */
        }
        /* ä¿®æ”¹æŒ‰é’®æ ·å¼éƒ¨åˆ† */
        button {
            background-color: #007BFF;
            color: #fff;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1.2rem;
            width: 180px;
            height: 60px;
            line-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            transition: all 0.2s cubic-bezier(0.5, 1.5, 0.5, 1); /* ä¿®æ”¹ä¸ºå¼¹æ€§åŠ¨ç”» */
        }
        button:active {
            transform: scale(0.85); /* å¢åŠ ç¼©å°æ¯”ä¾‹ */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }
        
        /* ä¸ºéšæœºé€‰æ‹©æŒ‰é’®æ·»åŠ æ›´æ˜æ˜¾çš„æ•ˆæœ */
        button[type="submit"]:active {
            transform: scale(0.8);
            background-color: #0062cc;
            box-shadow: 0 0 25px rgba(0, 123, 255, 0.7);
        }
        
        /* ä¸ºæ¸…é™¤æŒ‰é’®æ·»åŠ æ›´æ˜æ˜¾çš„æ•ˆæœ */
        #clearBtn:active {
            transform: scale(0.8);
            background-color: #bd2130;
            box-shadow: 0 0 25px rgba(220, 53, 69, 0.7);
        }
        #clearBtn {
            background-color: #dc3545;
            margin-left: 20px;
            width: 180px;
            height: 60px;
        }
        #result {
            font-size: 1.5rem;
            margin-top: 30px;
            transition: all 0.3s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #historyContainer h3 {
            font-size: 1.5rem;
        }
        #historyList li {
            font-size: 1.2rem;
            padding: 12px 20px;
        }
        .highlight {
            font-size: 1.2em;
            color: #007BFF;
            font-weight: bold;
            transition: color 0.1s;
        }
        .highlight.winner {
            animation: pulse 0.5s infinite alternate;
        }
        .highlight.persistent {
            animation: none;
            color: #ff5722;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255,87,34,0.5);
            transform: scale(1.1);
        }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        @media (max-width: 600px) {
            .container {
                width: 90%;
                padding: 15px;
            }
            button {
                width: 100%;
                margin-bottom: 10px;
            }
            #clearBtn {
                margin-left: 0;
            }
        }
        #historyContainer {
            margin-top: 20px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            /* æ·»åŠ ä»¥ä¸‹å±æ€§é˜²æ­¢æ¨ªå‘æ»šåŠ¨æ¡ */
            overflow-x: hidden;
        }
        #historyList li {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            /* ç¡®ä¿å†…å®¹ä¸æ¢è¡Œä¹Ÿä¸ä¼šæº¢å‡º */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #historyList {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #historyList li {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            /* æ·»åŠ ä»¥ä¸‹ä¼˜åŒ– */
            transform: translateX(0);
            transition: transform 0.2s ease, background 0.2s ease;
            will-change: transform;
        }
        #historyList li:hover {
            background: #e9ecef;
            transform: translateX(5px);
            /* ç§»é™¤åŸæ¥çš„transitionå£°æ˜ */
        }
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* åœ¨styleæ ‡ç­¾ä¸­æ·»åŠ  */
        #historyList li {
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        #historySearch {
            transition: all 0.2s ease;
        }
        #historySearch:focus {
            border-color: #007BFF;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
            <h1 contenteditable="true" id="title">éšæœºé€‰æ‹©ç¨‹åº</h1>
            <span class="edit-hint" style="color: #666; cursor: help; display: none;" title="ç‚¹å‡»æ ‡é¢˜å¯ç¼–è¾‘">âœï¸</span>
        </div>
        <form id="nameForm">
            <label for="names">è¯·è¾“å…¥åå­—ï¼Œç”¨é€—å·åˆ†éš”ï¼š</label>
            <textarea id="names" name="names" required></textarea>
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
                <button type="submit">å¼€å§‹</button>
                <button type="button" id="clearBtn" style="display: none;">æ¸…é™¤å†å²è®°å½•</button>
                <button type="button" id="resetHighlightBtn" style="display: none;">æ¸…é™¤é«˜äº®</button>
            </div>
        </form>
        <p id="result"></p>
        <div id="progressContainer" style="margin: 20px 0; visibility: hidden; height: 35px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span>é€‰æ‹©è¿›åº¦:</span>
                <span id="progressText">0%</span>
            </div>
            <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden;">
                <div id="progressBar" style="height: 100%; width: 0%; background: #007BFF; transition: width 0.1s ease;"></div>
            </div>
        </div>
        <!-- åœ¨container divå†…éƒ¨ï¼Œæ”¾åœ¨historyContainerä¹‹å -->
        <div id="historyContainer" style="display: none;">
            <h3>ğŸ“œ å†å²è®°å½•ï¼š</h3>
            <ul id="historyList"></ul>
        </div>
        
        <!-- å°†å¿«æ·é”®æç¤ºç§»åˆ°containerå†…éƒ¨ï¼Œå¹¶è°ƒæ•´æ ·å¼ -->
        <div style="margin: 20px auto 0; font-size: 0.9rem; color: #666; text-align: center; width: 100%;">
            <small>æç¤ºï¼šæŒ‰ Enter é”®å¼€å§‹é€‰æ‹©ï¼ŒæŒ‰ Esc é”®æ¸…é™¤å†å²è®°å½•</small>
        </div>
    </div>

    <script>
        let selectedNames = [];
        let history = [];

        if(localStorage.getItem('randomSelectorHistory')) {
            try {
                history = JSON.parse(localStorage.getItem('randomSelectorHistory'));
                if(history.length > 0) {
                    updateHistoryDisplay();
                }
            } catch(e) {
                console.error("è§£æå†å²è®°å½•å‡ºé”™:", e);
                localStorage.removeItem('randomSelectorHistory');
            }
        }

        // åœ¨è„šæœ¬é¡¶éƒ¨æ·»åŠ 
        let isSelecting = false;
        
        // ä¿®æ”¹è¡¨å•æäº¤å¤„ç†
        document.getElementById('nameForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const textarea = document.getElementById('names');
            textarea.blur(); // å…³é—­ç§»åŠ¨ç«¯é”®ç›˜
            
            if(isSelecting) return;
            isSelecting = true;
            
            // å¢å¼ºåˆ†éš”ç¬¦å¤„ç†
            const names = namesInput
                .replace(/[\r\n\s]+/g, ',')  // æ·»åŠ ç©ºç™½å­—ç¬¦å¤„ç†
                .replace(/[ï¼Œã€ï¼›;|]+/g, ',')
                .split(',')
                .map(name => name.trim())
                .filter(name => name.length > 0);
            
            if (names.length === 0) {
                alert("æ²¡æœ‰æ£€æµ‹åˆ°æœ‰æ•ˆçš„åå­—ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼ï¼");
                return;
            }
            
            const availableNames = names.filter(name => !selectedNames.includes(name));
            
            if (availableNames.length > 0) {
                document.getElementById('result').innerHTML = `
                    <span class="highlight">æ­£åœ¨éšæœºé€‰æ‹©ä¸­...</span>
                `;
                
                let counter = 0;
                const maxIterations = 15;
                document.getElementById('progressContainer').style.visibility = 'visible';
                const interval = setInterval(() => {
                    const progress = Math.floor((counter / maxIterations) * 100);
                    document.getElementById('progressBar').style.width = `${progress}%`;
                    document.getElementById('progressText').textContent = `${progress}%`;
                    const tempIndex = Math.floor(Math.random() * availableNames.length);
                    document.getElementById('result').innerHTML = `
                        <span class="highlight">${availableNames[tempIndex]}</span>
                    `;
                    
                    counter++;
                    if (counter >= maxIterations) {
                        clearInterval(interval);
                        document.getElementById('progressContainer').style.visibility = 'hidden';
                        const finalIndex = Math.floor(Math.random() * availableNames.length);
                        const result = availableNames[finalIndex];
                        selectedNames.push(result);
                        history.push({
                            name: result,
                            time: new Date()
                        });
                        
                        // ä¿®æ”¹ç»“æœæ˜¾ç¤ºå¤„ç†
                        const resultElement = document.getElementById('result');
                        resultElement.innerHTML = `
                            éšæœºé€‰æ‹©çš„ç»“æœæ˜¯ï¼š<span class="highlight winner">${result}</span>
                            <small style="display:block;margin-top:8px;">ç‚¹å‡»ç»“æœå¯ä¿æŒé«˜äº®</small>
                        `;
                        
                        // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                        resultElement.querySelector('.highlight').addEventListener('touchend', function(e) {
                            e.preventDefault();
                            this.classList.toggle('persistent');
                            this.classList.toggle('winner');
                        });
                        
                        updateHistoryDisplay();
                        isSelecting = false;  // é€‰æ‹©å®Œæˆï¼Œé‡ç½®çŠ¶æ€
                        submitBtn.textContent = 'éšæœºé€‰æ‹©';  // æ¢å¤æŒ‰é’®æ–‡å­—
                        isSelecting = false;
                    }
                }, 150);
            } else {
                document.getElementById('result').textContent = "æ‰€æœ‰åå­—éƒ½å·²è¢«é€‰æ‹©è¿‡ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚";
                selectedNames = [];
                isSelecting = false;  // é€‰æ‹©å®Œæˆï¼Œé‡ç½®çŠ¶æ€
                submitBtn.textContent = 'éšæœºé€‰æ‹©';  // æ¢å¤æŒ‰é’®æ–‡å­—
                isSelecting = false;
            }
        });

        document.getElementById('clearBtn').addEventListener('click', function() {
            // åªæœ‰åœ¨éé€‰æ‹©çŠ¶æ€ä¸‹æ‰èƒ½æ¸…é™¤
            if(isSelecting) {
                alert("è¯·ç­‰å¾…éšæœºé€‰æ‹©å®Œæˆåå†æ“ä½œ");
                return;
            }
            
            if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ")) {
                history = [];
                selectedNames = [];
                document.getElementById('historyContainer').style.display = 'none';
                document.getElementById('clearBtn').style.display = 'none';
                document.getElementById('result').textContent = '';
                localStorage.removeItem('randomSelectorHistory');
            }
        });

        const title = document.getElementById('title');
        const editHint = document.querySelector('.edit-hint');
        
        title.addEventListener('focus', function() {
            editHint.style.display = 'inline';
        });
        
        title.addEventListener('blur', function() {
            editHint.style.display = 'none';
        });

        // ä¿®æ”¹updateHistoryDisplayå‡½æ•°
        function updateHistoryDisplay() {
            if (history.length > 0) {
                // ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µæé«˜æ€§èƒ½
                const fragment = document.createDocumentFragment();
                history.slice().reverse().forEach((item, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${history.length - index}. ${item.name}</span>
                        <small>${formatTime(new Date(item.time))}</small>
                    `;
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    li.addEventListener('click', async function() {
                        try {
                            await navigator.clipboard.writeText(history[history.length - 1 - index].name);
                            const originalHTML = li.innerHTML;
                            li.innerHTML = `
                                <span style="color:#28a745">âœ“ å·²å¤åˆ¶ ${history[history.length - 1 - index].name}</span>
                                <small>${formatTime(new Date(history[history.length - 1 - index].time))}</small>
                            `;
                            setTimeout(() => {
                                li.innerHTML = originalHTML;
                            }, 1000);
                        } catch (err) {
                            console.error('å¤åˆ¶å¤±è´¥:', err);
                            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                        }
                    });
                });
                
                document.getElementById('historyContainer').style.display = 'block';
                document.getElementById('clearBtn').style.display = 'inline-block';
                
                // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°è®°å½•
                if (listItems.length > 0) {
                    listItems[0].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
                
                try {
                    localStorage.setItem('randomSelectorHistory', JSON.stringify(history));
                } catch(e) {
                    console.error("ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:", e);
                }
            } else {
                document.getElementById('historyContainer').style.display = 'none';
                document.getElementById('clearBtn').style.display = 'none';
                localStorage.removeItem('randomSelectorHistory');
            }
        }

        function formatTime(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
        // åœ¨è„šæœ¬åˆå§‹åŒ–éƒ¨åˆ†æ·»åŠ ï¼ˆæ”¾åœ¨å…¶ä»–äº‹ä»¶ç›‘å¬å™¨é™„è¿‘ï¼‰
        // ä¿®æ”¹é”®ç›˜äº‹ä»¶å¤„ç†
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.repeat) {
                e.preventDefault();
                // æ·»åŠ é˜²æŠ–å¤„ç†
                if(!this.lastKeyTime || (Date.now() - this.lastKeyTime > 300)) {
                    this.lastKeyTime = Date.now();
                    // ...è§¦å‘æäº¤...
                }
            }
        });
    </script>
</body>
</html>